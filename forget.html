<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Forgot Password - E-Shopping</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <h1 class="title">Reset Password</h1>
    
    <fieldset>
        <form id="reset-form">
            <label for="email">Email:</label>
            <input type="email" id="email" required placeholder="Enter your email"><br>
            
            <div class="btn-container">
                <button type="button" onclick="window.location.href='login.html';">Back</button>
                <button type="button" id="reset-btn">Reset Password</button>
            </div>
        </form>
        
        <div id="resetMessage" style="display: none; text-align: center; padding: 15px; margin-top: 15px; border-radius: 5px;"></div>
        
        <p><strong><a href="login.html">Remember your password? Sign In</a></strong></p>
    </fieldset>
    
    <!-- Use the same Firebase version as other pages (v10.7.1) -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    
    <script>
        // Firebase configuration (same as in other files)
        const firebaseConfig = {
            apiKey: "AIzaSyBKswcE3xGh4feqGZytevh6N-IyrJoJ_7g",
            authDomain: "jeahluy.firebaseapp.com",
            projectId: "jeahluy",
            storageBucket: "jeahluy.firebasestorage.app",
            messagingSenderId: "308746007810",
            appId: "1:308746007810:web:c17396303b14d61c3b3e1b",
            measurementId: "G-3RLD0EB1FT"
        };

        // Initialize Firebase
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        } else {
            firebase.app(); // Use existing app
        }

        const auth = firebase.auth();

        document.getElementById("reset-btn").addEventListener("click", function() {
            const email = document.getElementById("email").value.trim();
            const resetBtn = document.getElementById("reset-btn");
            const resetMessage = document.getElementById("resetMessage");
            
            if (!email) {
                showMessage('Please enter your email', 'error');
                return;
            }
            
            // Validate email format
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                showMessage('Please enter a valid email address', 'error');
                return;
            }
            
            // Disable button to prevent multiple clicks
            resetBtn.disabled = true;
            resetBtn.textContent = 'Sending...';
            
            // Show loading message
            showMessage('Sending password reset email...', 'info');
            
            // Send password reset email
            auth.sendPasswordResetEmail(email)
                .then(() => {
                    showMessage('✅ Password reset email sent! Please check your inbox and spam folder.', 'success');
                    resetBtn.textContent = 'Email Sent!';
                    
                    // Clear form
                    document.getElementById("email").value = '';
                    
                    // Redirect to login page after 3 seconds
                    setTimeout(() => {
                        window.location.href = "login.html";
                    }, 3000);
                })
                .catch((error) => {
                    console.error("Password reset error:", error);
                    
                    let errorMessage = error.message;
                    
                    // User-friendly error messages
                    if (error.code === 'auth/user-not-found') {
                        errorMessage = 'No account found with this email address.';
                    } else if (error.code === 'auth/invalid-email') {
                        errorMessage = 'Please enter a valid email address.';
                    } else if (error.code === 'auth/too-many-requests') {
                        errorMessage = 'Too many requests. Please try again later.';
                    } else if (error.code === 'auth/network-request-failed') {
                        errorMessage = 'Network error. Please check your connection.';
                    }
                    
                    showMessage('❌ ' + errorMessage, 'error');
                    resetBtn.disabled = false;
                    resetBtn.textContent = 'Reset Password';
                });
        });

        function showMessage(message, type) {
            const resetMessage = document.getElementById("resetMessage");
            resetMessage.textContent = message;
            resetMessage.style.display = 'block';
            
            // Set colors based on message type
            if (type === 'success') {
                resetMessage.style.backgroundColor = '#d4edda';
                resetMessage.style.color = '#155724';
                resetMessage.style.border = '1px solid #c3e6cb';
            } else if (type === 'error') {
                resetMessage.style.backgroundColor = '#f8d7da';
                resetMessage.style.color = '#721c24';
                resetMessage.style.border = '1px solid #f5c6cb';
            } else {
                resetMessage.style.backgroundColor = '#d1ecf1';
                resetMessage.style.color = '#0c5460';
                resetMessage.style.border = '1px solid #bee5eb';
            }
        }

        // Handle Enter key in email field
        document.getElementById("email").addEventListener("keypress", function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                document.getElementById("reset-btn").click();
            }
        });

        // Check if user is already logged in
        auth.onAuthStateChanged((user) => {
            if (user) {
                // Pre-fill the email field if user is logged in
                document.getElementById("email").value = user.email;
                
                // Show a message
                const resetMessage = document.getElementById("resetMessage");
                resetMessage.innerHTML = 'You are currently logged in as <strong>' + user.email + '</strong>.';
                resetMessage.style.display = 'block';
                resetMessage.style.backgroundColor = '#e2f0ff';
                resetMessage.style.color = '#004085';
                resetMessage.style.border = '1px solid #b8daff';
            }
        });
    </script>
</body>
</html>
