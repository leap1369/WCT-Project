

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JeahLuy</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Header */
        header {
            background-color: white;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 15px 5%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .merchant-profile {
            align-self: center;
            font-weight: bold;
            font-size: 18px;
            cursor: pointer;
        }

        .user-section {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .profile-pic {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: #85BB65;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            cursor: pointer;
        }

        .profile-pic img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .auth-buttons {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 8px 16px;
            border-radius: 4px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
        }

        .sign-in {
            background-color: transparent;
            border: 1px solid #85BB65;
            color: #85BB65;
        }

        .register {
            background-color: #85BB65;
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .merchant-profile {
            background-color: #ff6b6b;
            color: white;
            padding: 8px 16px;
            border-radius: 4px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .merchant-profile:hover {
            background-color: #ff5252;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .name {
            display: flex;
            font-size: 24px;
            font-weight: bold;
            color: #333;
            margin: 0;
            cursor: pointer;
            padding: 0;
        }

        /* Search Section */
        .search-section {
            text-align: center;
            padding: 40px 5% 20px;
            background: linear-gradient(135deg, #85BB65, #85BB65);
            color: white;
        }

        .search-container {
            max-width: 600px;
            margin: 0 auto 20px;
            position: relative;
        }

        .search-bar {
            width: 100%;
            padding: 15px 50px 15px 20px;
            border-radius: 30px;
            border: none;
            font-size: 16px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .search-bar:focus {
            outline: none;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
        }

        .mic-icon {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: #85BB65;
            cursor: pointer;
            background: white;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .discover-text {
            font-size: 24px;
            font-weight: 600;
            margin: 30px 0 20px;
        }

        /* Categories Section */
        .categories {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 30px;
        }

        .category {
            background-color: rgba(255, 255, 255, 0.2);
            padding: 15px 20px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 8px;
            text-align: center;
            min-width: 100px;
        }

        .category img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            display: block;
        }

        .category:hover {
            background-color: rgba(255, 255, 255, 0.3);
            transform: translateY(-3px);
        }

        /* Products Section */
        .products-section {
            padding: 30px 5%;
        }

        .section-title {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 20px;
            color: #333;
            text-align: center;
        }

        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 25px;
        }

        .product-card {
            background-color: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        .product-image {
            height: 200px;
            background-color: #f5f5f5;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .product-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s ease;
        }

        .product-card:hover .product-image img {
            transform: scale(1.05);
        }

        .product-info {
            padding: 15px;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }

        .product-title {
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 16px;
        }

        .product-price {
            color: #85BB65;
            font-weight: 700;
            font-size: 18px;
            margin-bottom: 10px;
        }

        .product-rating {
            color: #ffc107;
            margin-bottom: 10px;
        }

        .add-to-cart {
            background-color: #85BB65;
            color: white;
            width: 100%;
            padding: 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
            font-weight: 500;
            margin-top: auto;
        }

        .add-to-cart:hover {
            background-color: #3a5a80;
        }
        
        /* Welcome Message */
        .welcome-message {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 500;
            color: #333;
        }

        .username {
            font-weight: bold;
            color: #85BB65;
        }

        .logout {
            background-color: #ff6b6b;
            color: white;
            padding: 6px 12px;
            border-radius: 4px;
            border: none;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
        }

        .logout:hover {
            background-color: #ff5252;
            transform: translateY(-2px);
        }

        .product-link {
            text-decoration: none;
            color: inherit;
            display: block;
            flex-grow: 1;
        }

        /* Floating Shopping Cart */
        .floating-cart {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 1000;
        }

        .cart-icon-container {
            position: relative;
            width: 60px;
            height: 60px;
            background-color: #85BB65;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
            animation: pulse 2s infinite;
        }

        .cart-icon-container:hover {
            background-color: #3a5a80;
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        .cart-icon-container i {
            font-size: 24px;
            color: white;
        }

        .cart-count {
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: #ff6b6b;
            color: white;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
        }

        /* Cart Preview Modal */
        .cart-preview {
            position: absolute;
            bottom: 70px;
            right: 0;
            width: 350px;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            display: none;
            flex-direction: column;
            max-height: 500px;
            overflow: hidden;
        }

        .cart-preview.show {
            display: flex;
            animation: slideUp 0.3s ease;
        }

        .cart-preview-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background-color: #85BB65;
            color: white;
            border-top-left-radius: 10px;
            border-top-right-radius: 10px;
        }

        .cart-preview-header h3 {
            margin: 0;
            font-size: 18px;
        }

        .close-cart-preview {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            line-height: 1;
        }

        .cart-items-container {
            padding: 15px;
            flex-grow: 1;
            overflow-y: auto;
            max-height: 300px;
        }

        .empty-cart-message {
            text-align: center;
            padding: 40px 20px;
            color: #999;
        }

        .empty-cart-message i {
            font-size: 48px;
            margin-bottom: 15px;
            color: #ddd;
        }

        .empty-cart-message p {
            margin: 0;
            font-size: 16px;
        }

        .cart-item {
            display: flex;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }

        .cart-item:last-child {
            border-bottom: none;
        }

        .cart-item-image {
            width: 60px;
            height: 60px;
            border-radius: 5px;
            overflow: hidden;
            margin-right: 15px;
        }

        .cart-item-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .cart-item-details {
            flex-grow: 1;
        }

        .cart-item-title {
            font-weight: 500;
            font-size: 14px;
            margin-bottom: 5px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .cart-item-price {
            color: #85BB65;
            font-weight: bold;
            font-size: 14px;
        }

        .cart-item-actions {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 5px;
        }

        .quantity-btn {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background-color: #f0f0f0;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }

        .remove-item {
            background-color: #ff6b6b;
            color: white;
            border: none;
            padding: 2px 8px;
            border-radius: 3px;
            font-size: 12px;
            cursor: pointer;
        }

        .cart-preview-footer {
            padding: 15px 20px;
            border-top: 1px solid #eee;
            background-color: #f9f9f9;
            border-bottom-left-radius: 10px;
            border-bottom-right-radius: 10px;
        }

        .cart-total {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            font-size: 18px;
            font-weight: bold;
        }

        .total-amount {
            color: #85BB65;
        }

        .view-cart-btn {
            width: 100%;
            padding: 12px;
            background-color: #85BB65;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .view-cart-btn:hover {
            background-color: #3a5a80;
        }

        /* Side Profile Panel */
        .side-profile-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1001;
            animation: fadeIn 0.3s ease;
        }

        .side-profile-overlay.show {
            display: block;
        }

        .side-profile {
            position: fixed;
            top: 0;
            left: -400px;
            width: 350px;
            height: 100%;
            background-color: white;
            box-shadow: 5px 0 20px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
            z-index: 1002;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .side-profile.show {
            transform: translateX(400px);
        }

        .side-profile-header {
            padding: 20px;
            background: linear-gradient(135deg, #85BB65, #3a5a80);
            color: white;
            position: relative;
        }

        .close-side-profile {
            position: absolute;
            top: 20px;
            left: 20px;
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
        }

        .user-info-side {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-top: 20px;
        }

        .profile-pic-side {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #85BB65;
            font-size: 24px;
        }

        .user-details-side h3 {
            margin: 0;
            font-size: 18px;
            font-weight: 600;
        }

        .user-details-side p {
            margin: 5px 0 0;
            font-size: 14px;
            opacity: 0.9;
        }

        .side-profile-menu {
            flex-grow: 1;
            overflow-y: auto;
            padding: 20px 0;
        }

        .menu-section {
            margin-bottom: 20px;
        }

        .menu-section h4 {
            padding: 0 20px 10px;
            margin: 0;
            font-size: 14px;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-bottom: 1px solid #eee;
        }

        .menu-items {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .menu-item {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            border-left: 3px solid transparent;
        }

        .menu-item:hover {
            background-color: #f8f9fa;
            border-left-color: #85BB65;
        }

        .menu-item.active {
            background-color: #f0f7ff;
            border-left-color: #85BB65;
        }

        .menu-icon {
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            color: #666;
        }

        .menu-text {
            flex-grow: 1;
            font-size: 16px;
            color: #333;
        }

        .menu-badge {
            background-color: #ff6b6b;
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 12px;
            font-weight: 600;
        }

        .menu-arrow {
            color: #999;
            font-size: 12px;
        }

        .side-profile-footer {
            padding: 20px;
            border-top: 1px solid #eee;
            background-color: #f8f9fa;
        }

        .theme-toggle {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
        }

        .theme-label {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 14px;
            color: #666;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: #85BB65;
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        /* Profile Content Area */
        .profile-content {
            display: none;
            padding: 20px;
            background-color: white;
            position: absolute;
            top: 0;
            left: 350px;
            width: 350px;
            height: 100%;
            box-shadow: 5px 0 20px rgba(0, 0, 0, 0.1);
            z-index: 1003;
            overflow-y: auto;
        }

        .profile-content.show {
            display: block;
            animation: slideInLeft 0.3s ease;
        }

        .content-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }

        .content-header h3 {
            margin: 0;
            color: #333;
        }

        .back-button {
            background: none;
            border: none;
            color: #85BB65;
            font-size: 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        /* Animations */
        @keyframes pulse {
            0% {
                box-shadow: 0 4px 15px rgba(133, 187, 101, 0.4);
            }
            50% {
                box-shadow: 0 4px 20px rgba(133, 187, 101, 0.7);
            }
            100% {
                box-shadow: 0 4px 15px rgba(133, 187, 101, 0.4);
            }
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideInLeft {
            from { 
                transform: translateX(-20px); 
                opacity: 0; 
            }
            to { 
                transform: translateX(0); 
                opacity: 1; 
            }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .side-profile {
                width: 300px;
                left: -300px;
            }
            
            .side-profile.show {
                transform: translateX(300px);
            }
            
            .profile-content {
                width: 300px;
                left: 300px;
            }
        }

        @media (max-width: 480px) {
            .side-profile {
                width: 280px;
                left: -280px;
            }
            
            .side-profile.show {
                transform: translateX(280px);
            }
            
            .profile-content {
                width: 280px;
                left: 280px;
            }
            
            .products-grid {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
                gap: 15px;
            }
            
            .category {
                min-width: 80px;
                padding: 10px 15px;
            }
        }
    </style>
</head>
<body>

<!-- Header Section -->
<header>
    <div class="user-section">
        <div class="profile-pic" id="profilePic" onclick="handleProfileClick()">
            <i class="fas fa-user" style="font-size: 2em;"></i>
        </div>
        <div class="auth-buttons" id="authButtons">
            <button class="btn sign-in" onclick="window.location.href='login.html';">Sign In</button>
            <button class="btn register" onclick="window.location.href='register.html';">Register</button>
        </div>
    </div>
    <div class="name">
        <img src="asset/logo.jpeg" alt="Logo" width="80" height="80">
    </div>
    <div class="merchant-profile" id="become-merchant-btn" onclick="handleMerchantClick()">
        Become Merchant
        <i class="fa-solid fa-store" style="font-size: 2em;"></i>
    </div>
</header>   

<!-- Search Section -->
<section class="search-section">
    <div class="search-container">
        <input type="text" class="search-bar" id="searchInput" placeholder="Search for products, brands and more...">
        <div class="mic-icon">
            <i class="fas fa-microphone"></i>
        </div>
    </div>
    <div class="discover-text">Discover</div>
    <div class="categories" id="categoriesContainer">
        <!-- Categories will be loaded dynamically -->
    </div>  
</section>

<!-- Products Section -->
<section class="products-section">
    <h2 class="section-title">Featured Products</h2>
    <div class="products-grid" id="productsContainer">
        <!-- Products will be loaded dynamically -->
    </div>
</section>

<!-- Shopping Cart Icon -->
<div class="floating-cart">
    <div class="cart-icon-container" onclick="toggleCartPreview()">
        <i class="fas fa-shopping-cart"></i>
        <span class="cart-count">0</span>
    </div>
    
    <!-- Cart Preview Modal -->
    <div class="cart-preview" id="cartPreview">
        <div class="cart-preview-header">
            <h3>Your Cart</h3>
            <button class="close-cart-preview" onclick="toggleCartPreview()">&times;</button>
        </div>
        <div class="cart-items-container" id="cartItemsContainer">
            <div class="empty-cart-message">
                <i class="fas fa-shopping-basket"></i>
                <p>Your cart is empty</p>
            </div>
        </div>
        <div class="cart-preview-footer">
            <div class="cart-total">
                <span>Total:</span>
                <span class="total-amount">$0.00</span>
            </div>
            <button class="view-cart-btn" onclick="proceedToCheckout()">Checkout</button>
        </div>
    </div>
</div>

<!-- Side Profile Overlay -->
<div class="side-profile-overlay" onclick="closeSideProfile()"></div>

<!-- Side Profile Panel -->
<div class="side-profile" id="sideProfile">
    <div class="side-profile-header">
        <button class="close-side-profile" onclick="closeSideProfile()">&times;</button>
        <div class="user-info-side">
            <div class="profile-pic-side">
                <i class="fas fa-user"></i>
            </div>
            <div class="user-details-side">
                <h3 id="sideUsername">Guest User</h3>
                <p id="sideEmail">guest@example.com</p>
            </div>
        </div>
    </div>

    <div class="side-profile-menu">
        <div class="menu-section">
            <h4>Account</h4>
            <ul class="menu-items">
                <li class="menu-item active" onclick="showProfileSection('profile')">
                    <div class="menu-icon">
                        <i class="fas fa-user-circle"></i>
                    </div>
                    <div class="menu-text">Profile</div>
                    <div class="menu-arrow">›</div>
                </li>
                <li class="menu-item" onclick="showProfileSection('orders')">
                    <div class="menu-icon">
                        <i class="fas fa-shopping-bag"></i>
                    </div>
                    <div class="menu-text">Order List</div>
                    <div class="menu-badge" id="cartBadge">0</div>
                </li>
                <li class="menu-item" onclick="showProfileSection('history')">
                    <div class="menu-icon">
                        <i class="fas fa-history"></i>
                    </div>
                    <div class="menu-text">Order History</div>
                </li>
            </ul>
        </div>

        <div class="menu-section">
            <h4>Orders</h4>
            <ul class="menu-items">
                <li class="menu-item" onclick="showProfileSection('topay')">
                    <div class="menu-icon">
                        <i class="fas fa-money-bill-wave"></i>
                    </div>
                    <div class="menu-text">To Pay</div>
                    <div class="menu-badge" id="topayBadge">0</div>
                </li>
                <li class="menu-item" onclick="showProfileSection('toship')">
                    <div class="menu-icon">
                        <i class="fas fa-shipping-fast"></i>
                    </div>
                    <div class="menu-text">To Ship</div>
                    <div class="menu-badge" id="toshipBadge">0</div>
                </li>
                <li class="menu-item" onclick="showProfileSection('toreceive')">
                    <div class="menu-icon">
                        <i class="fas fa-box-open"></i>
                    </div>
                    <div class="menu-text">To Receive</div>
                    <div class="menu-badge" id="toreceiveBadge">0</div>
                </li>
                <li class="menu-item" onclick="showProfileSection('toreview')">
                    <div class="menu-icon">
                        <i class="fas fa-star"></i>
                    </div>
                    <div class="menu-text">To Review</div>
                    <div class="menu-badge" id="toreviewBadge">0</div>
                </li>
            </ul>
        </div>

        <div class="menu-section">
            <h4>Settings</h4>
            <ul class="menu-items">
                <li class="menu-item" onclick="showProfileSection('settings')">
                    <div class="menu-icon">
                        <i class="fas fa-cog"></i>
                    </div>
                    <div class="menu-text">Settings</div>
                    <div class="menu-arrow">›</div>
                </li>
            </ul>
        </div>
    </div>

    <div class="side-profile-footer">
        <div class="theme-toggle">
            <div class="theme-label">
                <i class="fas fa-moon"></i>
                <span>Dark Mode</span>
            </div>
            <label class="switch">
                <input type="checkbox" id="themeToggle" onchange="toggleTheme()">
                <span class="slider"></span>
            </label>
        </div>
    </div>
</div>

<!-- Profile Content Area -->
<div class="profile-content" id="profileContent"></div>

<!-- Firebase v10.7.1 - COMPATIBILITY VERSION -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

<script>
    // Firebase Configuration
    const firebaseConfig = {
        apiKey: "AIzaSyBKswcE3xGh4feqGZytevh6N-IyrJoJ_7g",
        authDomain: "jeahluy.firebaseapp.com",
        projectId: "jeahluy",
        storageBucket: "jeahluy.firebasestorage.app",
        messagingSenderId: "308746007810",
        appId: "1:308746007810:web:c17396303b14d61c3b3e1b",
        measurementId: "G-3RLD0EB1FT"
    };

    // Initialize Firebase with compat version
    if (!firebase.apps.length) {
        firebase.initializeApp(firebaseConfig);
    }
    
    // Get auth and firestore instances
    const auth = firebase.auth();
    const db = firebase.firestore();
    const FieldValue = firebase.firestore.FieldValue;

    // Global variables
    let currentUser = null;
    let products = [];
    let cart = [];
    let selectedCategory = 'all';

    // Initialize when page loads
    document.addEventListener('DOMContentLoaded', function() {
        console.log("Initializing homepage with new layout...");
        
        // Check authentication state
        auth.onAuthStateChanged(async (user) => {
            if (user) {
                console.log("User is signed in:", user.uid);
                currentUser = user;
                
                // Create or update user document in Firestore
                await createOrUpdateUserDocument(user);
                
                updateUIForLoggedInUser(user);
                loadUserCart(user.uid);
            } else {
                console.log("User is signed out");
                currentUser = null;
                updateUIForGuest();
            }
        });
        
        // Load products and categories
        loadProducts();
        setupEventListeners();
    });

    // Function to create or update user document in Firestore
    async function createOrUpdateUserDocument(user) {
        try {
            const userRef = db.collection('users').doc(user.uid);
            const userDoc = await userRef.get();
            
            if (!userDoc.exists) {
                // Create new user document
                await userRef.set({
                    email: user.email,
                    displayName: user.displayName || user.email.split('@')[0],
                    firstName: user.displayName ? user.displayName.split(' ')[0] : '',
                    lastName: user.displayName ? user.displayName.split(' ').slice(1).join(' ') : '',
                    emailVerified: user.emailVerified || false,
                    role: "user",
                    createdAt: FieldValue.serverTimestamp(),
                    profilePicture: user.photoURL || '',
                    lastLogin: FieldValue.serverTimestamp()
                });
                console.log("User document created in Firestore");
            } else {
                // Update last login
                await userRef.update({
                    lastLogin: FieldValue.serverTimestamp()
                });
                
                // Get user data for UI
                const userData = userDoc.data();
                localStorage.setItem('currentUser', JSON.stringify({
                    uid: user.uid,
                    ...userData
                }));
            }
        } catch (error) {
            console.error('Error creating/updating user document:', error);
        }
    }

    function updateUIForLoggedInUser(user) {
        const authButtons = document.getElementById('authButtons');
        const profilePic = document.getElementById('profilePic');
        
        // Remove any existing welcome message
        const existingWelcome = document.querySelector('.welcome-message');
        if (existingWelcome) {
            existingWelcome.remove();
        }
        
        // Get user data
        const userData = JSON.parse(localStorage.getItem('currentUser') || '{}');
        const displayName = userData.displayName || user.email.split('@')[0];
        
        // Hide auth buttons and show welcome message
        authButtons.style.display = 'none';
        
        const welcomeDiv = document.createElement('div');
        welcomeDiv.className = 'welcome-message';
        welcomeDiv.innerHTML = `
            Welcome, <span class="username">${displayName}</span>!
            <button class="btn logout" onclick="logout()">Logout</button>
        `;
        
        // Insert welcome message
        const userSection = document.querySelector('.user-section');
        if (userSection) {
            userSection.insertBefore(welcomeDiv, authButtons);
        }
        
        // Update profile picture
        if (userData.profilePicture) {
            profilePic.innerHTML = `<img src="${userData.profilePicture}" alt="Profile" style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover;">`;
        } else {
            const initials = displayName.charAt(0).toUpperCase();
            profilePic.innerHTML = `<span style="font-size: 1.5em;">${initials}</span>`;
        }
        
        // Update side profile
        document.getElementById('sideUsername').textContent = displayName;
        document.getElementById('sideEmail').textContent = user.email;
    }

    function updateUIForGuest() {
        const authButtons = document.getElementById('authButtons');
        authButtons.style.display = 'flex';
        
        // Clear any welcome message
        const existingWelcome = document.querySelector('.welcome-message');
        if (existingWelcome) {
            existingWelcome.remove();
        }
        
        // Reset profile picture
        const profilePic = document.getElementById('profilePic');
        profilePic.innerHTML = `<i class="fas fa-user" style="font-size: 2em;"></i>`;
        
        // Reset side profile
        document.getElementById('sideUsername').textContent = 'Guest User';
        document.getElementById('sideEmail').textContent = 'guest@example.com';
        
        // Clear cart for guest (use localStorage for guest cart)
        loadGuestCart();
    }

    function loadGuestCart() {
        try {
            const savedCart = localStorage.getItem('guestCart');
            if (savedCart) {
                cart = JSON.parse(savedCart) || [];
            } else {
                cart = [];
            }
        } catch (error) {
            console.error('Error loading guest cart:', error);
            cart = [];
        }
        updateCartCount();
        renderCartPreview();
    }

    function saveGuestCart() {
        if (!currentUser) {
            localStorage.setItem('guestCart', JSON.stringify(cart));
        }
    }

    function handleMerchantClick() {
        if (!currentUser) {
            alert('Please login to become a merchant');
            window.location.href = 'login.html';
        } else {
            window.location.href = 'merchant-register-information.html';
        }
    }

    function handleProfileClick() {
        if (!currentUser) {
            window.location.href = 'login.html';
            return;
        }
        openSideProfile();
    }

    function openSideProfile() {
        document.getElementById('sideProfile').classList.add('show');
        document.querySelector('.side-profile-overlay').classList.add('show');
        setActiveMenuItem('profile');
        showProfileSection('profile');
    }

    function closeSideProfile() {
        document.getElementById('sideProfile').classList.remove('show');
        document.querySelector('.side-profile-overlay').classList.remove('show');
        document.getElementById('profileContent').classList.remove('show');
    }

    function logout() {
        auth.signOut()
            .then(() => {
                currentUser = null;
                localStorage.removeItem('currentUser');
                updateUIForGuest();
                closeSideProfile();
                showNotification('Logged out successfully!');
            })
            .catch(error => {
                console.error('Logout error:', error);
                alert('Error logging out: ' + error.message);
            });
    }

    function setActiveMenuItem(sectionId) {
        document.querySelectorAll('.menu-item').forEach(item => {
            item.classList.remove('active');
        });
        
        const menuItem = document.querySelector(`[onclick*="${sectionId}"]`);
        if (menuItem) {
            menuItem.classList.add('active');
        }
    }

    function showProfileSection(sectionId) {
        setActiveMenuItem(sectionId);
        
        const contentDiv = document.getElementById('profileContent');
        const userData = JSON.parse(localStorage.getItem('currentUser') || '{}');
        const user = auth.currentUser;
        
        let contentHTML = '';
        
        switch(sectionId) {
            case 'profile':
                contentHTML = `
                    <div class="content-header">
                        <h3>Profile</h3>
                        <button class="back-button" onclick="closeProfileContent()">
                            Back <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                    <div class="profile-details">
                        <div style="text-align: center; margin-bottom: 20px;">
                            <div class="profile-pic-side" style="width: 100px; height: 100px; margin: 0 auto; background-color: #85BB65;">
                                ${userData.profilePicture ? 
                                    `<img src="${userData.profilePicture}" alt="Profile" style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover;">` :
                                    `<i class="fas fa-user" style="font-size: 48px; color: white; line-height: 100px;"></i>`
                                }
                            </div>
                            <h3>${userData.displayName || 'User'}</h3>
                            <p>${userData.email || user?.email || 'No email'}</p>
                        </div>
                        
                        <div style="padding: 20px;">
                            <div style="margin-bottom: 15px;">
                                <strong>First Name:</strong> ${userData.firstName || 'Not set'}
                            </div>
                            <div style="margin-bottom: 15px;">
                                <strong>Last Name:</strong> ${userData.lastName || 'Not set'}
                            </div>
                        </div>
                        
                        <button class="view-cart-btn" onclick="editProfile()" style="margin: 20px;">
                            <i class="fas fa-edit"></i> Edit Profile
                        </button>
                    </div>
                `;
                break;
                
            default:
                contentHTML = `
                    <div class="content-header">
                        <h3>${sectionId.charAt(0).toUpperCase() + sectionId.slice(1)}</h3>
                        <button class="back-button" onclick="closeProfileContent()">
                            Back <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                    <div style="padding: 20px; text-align: center;">
                        <p>Feature coming soon!</p>
                    </div>
                `;
        }
        
        contentDiv.innerHTML = contentHTML;
        contentDiv.classList.add('show');
    }

    function closeProfileContent() {
        document.getElementById('profileContent').classList.remove('show');
        setActiveMenuItem('profile');
    }

    function toggleTheme() {
        document.body.classList.toggle('dark-mode');
        const isDarkMode = document.body.classList.contains('dark-mode');
        localStorage.setItem('darkMode', isDarkMode);
    }

    async function loadProducts() {
        try {
            console.log("Loading products from Firestore...");
            
            const snapshot = await db.collection('product_list').get();
            products = [];
            
            snapshot.forEach(doc => {
                const product = {
                    id: doc.id,
                    ...doc.data()
                };
                products.push(product);
            });
            
            console.log(`Loaded ${products.length} products`);
            
            // Get unique categories
            const categories = ['all', ...new Set(products.map(p => p.category).filter(Boolean))];
            renderCategories(categories);
            renderProducts(products);
            
        } catch (error) {
            console.error('Error loading products:', error);
            document.getElementById('productsContainer').innerHTML = 
                '<div style="text-align: center; padding: 40px; color: #666;">Error loading products. Please refresh.</div>';
        }
    }

    function renderCategories(categories) {
        const container = document.getElementById('categoriesContainer');
        container.innerHTML = categories.map(category => `
            <div class="category" onclick="filterByCategory('${category}')">
                <div style="width: 50px; height: 50px; background-color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-bottom: 5px;">
                    <i class="fas fa-tag" style="color: #85BB65; font-size: 24px;"></i>
                </div>
                <span>${category.charAt(0).toUpperCase() + category.slice(1)}</span>
            </div>
        `).join('');
    }

    function filterByCategory(category) {
        selectedCategory = category;
        
        // Filter products
        const filteredProducts = category === 'all' 
            ? products 
            : products.filter(product => product.category === category);
        
        renderProducts(filteredProducts);
    }

    function renderProducts(productsToShow) {
        const container = document.getElementById('productsContainer');
        
        if (productsToShow.length === 0) {
            container.innerHTML = '<div style="text-align: center; padding: 40px; color: #666; grid-column: 1 / -1;">No products found</div>';
            return;
        }
        
        container.innerHTML = productsToShow.map(product => `
            <div class="product-card">
                <div class="product-image">
                    <img src="${product.imageUrl || 'https://via.placeholder.com/300x200'}" alt="${product.name}">
                </div>
                <div class="product-info">
                    <h3 class="product-title">${product.name}</h3>
                    <div class="product-price">$${parseFloat(product.price).toFixed(2)}</div>
                    ${product.rating ? `
                        <div class="product-rating">
                            ${'★'.repeat(Math.floor(product.rating))}${'☆'.repeat(5 - Math.floor(product.rating))}
                            (${product.rating})
                        </div>
                    ` : ''}
                </div>
                <button class="add-to-cart" onclick="addToCart('${product.id}', '${product.name.replace(/'/g, "\\'")}', ${product.price}, '${product.imageUrl || ''}')">
                    Add to Cart
                </button>
            </div>
        `).join('');
    }

    async function loadUserCart(userId) {
        try {
            console.log("Loading cart for user:", userId);
            
            const cartDoc = await db.collection('carts').doc(userId).get();
            
            if (cartDoc.exists) {
                cart = cartDoc.data().items || [];
                console.log("Loaded cart items:", cart.length);
            } else {
                // Create empty cart document
                await db.collection('carts').doc(userId).set({
                    userId: userId,
                    items: [],
                    updatedAt: FieldValue.serverTimestamp()
                });
                cart = [];
            }
            
            updateCartCount();
            renderCartPreview();
            
        } catch (error) {
            console.error('Error loading cart:', error);
            cart = [];
        }
    }

    async function addToCart(productId, productName, productPrice, productImage) {
        if (!currentUser) {
            // For guest users
            const existingItemIndex = cart.findIndex(item => item.id === productId);
            
            if (existingItemIndex > -1) {
                cart[existingItemIndex].quantity += 1;
            } else {
                cart.push({
                    id: productId,
                    name: productName,
                    price: productPrice,
                    image: productImage,
                    quantity: 1
                });
            }
            
            saveGuestCart();
        } else {
            // For logged in users
            const existingItemIndex = cart.findIndex(item => item.id === productId);
            
            if (existingItemIndex > -1) {
                cart[existingItemIndex].quantity += 1;
            } else {
                cart.push({
                    id: productId,
                    name: productName,
                    price: productPrice,
                    image: productImage,
                    quantity: 1
                });
            }
            
            // Save to Firestore
            await saveCartToFirestore();
        }
        
        // Update UI
        updateCartCount();
        renderCartPreview();
        showNotification(`Added ${productName} to cart`);
    }

    async function saveCartToFirestore() {
        if (!currentUser) return;
        
        try {
            await db.collection('carts').doc(currentUser.uid).set({
                userId: currentUser.uid,
                items: cart,
                updatedAt: FieldValue.serverTimestamp()
            }, { merge: true });
            
            console.log("Cart saved to Firestore");
        } catch (error) {
            console.error('Error saving cart:', error);
        }
    }

    async function removeFromCart(productId) {
        cart = cart.filter(item => item.id !== productId);
        
        if (currentUser) {
            await saveCartToFirestore();
        } else {
            saveGuestCart();
        }
        
        updateCartCount();
        renderCartPreview();
    }

    async function updateQuantity(productId, change) {
        const itemIndex = cart.findIndex(item => item.id === productId);
        
        if (itemIndex > -1) {
            cart[itemIndex].quantity += change;
            
            if (cart[itemIndex].quantity <= 0) {
                cart.splice(itemIndex, 1);
            }
            
            if (currentUser) {
                await saveCartToFirestore();
            } else {
                saveGuestCart();
            }
            
            updateCartCount();
            renderCartPreview();
        }
    }

    function updateCartCount() {
        const totalItems = cart.reduce((total, item) => total + item.quantity, 0);
        document.querySelector('.cart-count').textContent = totalItems;
        
        // Update cart badge in side profile
        const badgeElement = document.getElementById('cartBadge');
        if (badgeElement) {
            badgeElement.textContent = totalItems;
        }
    }

    function renderCartPreview() {
        const container = document.getElementById('cartItemsContainer');
        const totalElement = document.querySelector('.total-amount');
        
        if (cart.length === 0) {
            container.innerHTML = `
                <div class="empty-cart-message">
                    <i class="fas fa-shopping-basket"></i>
                    <p>Your cart is empty</p>
                </div>
            `;
            if (totalElement) totalElement.textContent = '$0.00';
            return;
        }
        
        let total = 0;
        let itemsHTML = '';
        
        cart.forEach(item => {
            const itemTotal = item.price * item.quantity;
            total += itemTotal;
            
            itemsHTML += `
                <div class="cart-item" data-product-id="${item.id}">
                    <div class="cart-item-image">
                        <img src="${item.image || 'https://via.placeholder.com/60'}" alt="${item.name}">
                    </div>
                    <div class="cart-item-details">
                        <div class="cart-item-title">${item.name}</div>
                        <div class="cart-item-price">$${item.price.toFixed(2)} × ${item.quantity}</div>
                        <div class="cart-item-actions">
                            <button class="quantity-btn" onclick="updateQuantity('${item.id}', -1)">-</button>
                            <span>${item.quantity}</span>
                            <button class="quantity-btn" onclick="updateQuantity('${item.id}', 1)">+</button>
                            <button class="remove-item" onclick="removeFromCart('${item.id}')">Remove</button>
                        </div>
                    </div>
                </div>
            `;
        });
        
        container.innerHTML = itemsHTML;
        if (totalElement) totalElement.textContent = `$${total.toFixed(2)}`;
    }

    function toggleCartPreview() {
        if (!currentUser && cart.length === 0) {
            showNotification('Your cart is empty');
            return;
        }
        
        const cartPreview = document.getElementById('cartPreview');
        cartPreview.classList.toggle('show');
    }

    function proceedToCheckout() {
        if (!currentUser) {
            alert('Please login to checkout');
            window.location.href = 'login.html';
            return;
        }
        
        if (cart.length === 0) {
            alert('Your cart is empty');
            return;
        }
        
        alert('Checkout feature coming soon!');
    }

    function editProfile() {
        alert('Edit profile feature coming soon!');
    }

    function showNotification(message) {
        // Simple notification implementation
        const notification = document.createElement('div');
        notification.textContent = message;
        notification.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: #85BB65;
            color: white;
            padding: 15px 20px;
            border-radius: 5px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            z-index: 1001;
            transform: translateX(150%);
            transition: transform 0.3s ease;
            max-width: 300px;
        `;
        
        document.body.appendChild(notification);
        
        // Animate in
        setTimeout(() => {
            notification.style.transform = 'translateX(0)';
        }, 10);
        
        // Remove after 3 seconds
        setTimeout(() => {
            notification.style.transform = 'translateX(150%)';
            setTimeout(() => {
                document.body.removeChild(notification);
            }, 300);
        }, 3000);
    }

    function setupEventListeners() {
        // Search functionality
        const searchInput = document.getElementById('searchInput');
        if (searchInput) {
            searchInput.addEventListener('input', function(e) {
                const searchTerm = e.target.value.toLowerCase();
                const filteredProducts = products.filter(product => 
                    product.name.toLowerCase().includes(searchTerm) ||
                    (product.description && product.description.toLowerCase().includes(searchTerm))
                );
                renderProducts(filteredProducts);
            });
        }
        
        // Close cart preview when clicking outside
        document.addEventListener('click', function(e) {
            const cartPreview = document.getElementById('cartPreview');
            const cartIcon = document.querySelector('.cart-icon-container');
            
            if (cartPreview && cartPreview.classList.contains('show') && 
                !cartPreview.contains(e.target) && 
                !cartIcon.contains(e.target)) {
                cartPreview.classList.remove('show');
            }
        });
        
        // Close cart preview with Escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                const cartPreview = document.getElementById('cartPreview');
                if (cartPreview && cartPreview.classList.contains('show')) {
                    cartPreview.classList.remove('show');
                }
            }
        });
        
        // Check for saved dark mode preference
        const savedDarkMode = localStorage.getItem('darkMode');
        if (savedDarkMode === 'true') {
            document.body.classList.add('dark-mode');
            document.getElementById('themeToggle').checked = true;
        }
    }

    // Expose functions to global scope
    window.handleProfileClick = handleProfileClick;
    window.handleMerchantClick = handleMerchantClick;
    window.closeSideProfile = closeSideProfile;
    window.showProfileSection = showProfileSection;
    window.closeProfileContent = closeProfileContent;
    window.toggleTheme = toggleTheme;
    window.toggleCartPreview = toggleCartPreview;
    window.logout = logout;
    window.addToCart = addToCart;
    window.updateQuantity = updateQuantity;
    window.removeFromCart = removeFromCart;
    window.proceedToCheckout = proceedToCheckout;
    window.filterByCategory = filterByCategory;
    window.editProfile = editProfile;
</script>
</body>
</html>
