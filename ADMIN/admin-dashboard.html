<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Admin Dashboard - Ecommerce Management</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="style-admin.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
  <header>
    <div class="flex">
      <span class="pill">Admin Panel</span>
      <nav>
        <ul>
          <li><a href="#dashboard">Dashboard</a></li>
          <li><a href="#users">Users</a></li>
          <li><a href="#applications">Merchant Applications</a></li>
          <li><a href="#merchants">Active Merchants</a></li>
          <li><a href="#orders">Orders</a></li>
          <li><a href="#products">Products</a></li>
        </ul>
      </nav>
    </div>
    <div class="flex">
      <div id="adminName" class="muted">Admin</div>
      <button id="logoutBtn" class="btn">Logout</button>
    </div>
  </header>

  <main>
    <!-- ===== Overview ===== -->
    <section id="dashboard" class="card">
      <h2>Admin Dashboard</h2>
      <div class="flex"><button id="refreshOverview" class="btn">Refresh Data</button></div>
      <div class="grid4" style="margin-top:12px;">
        <div class="card"><div class="big" id="totalUsers">0</div><div class="muted">Total Users</div></div>
        <div class="card"><div class="big" id="activeMerchants">0</div><div class="muted">Active Merchants</div></div>
        <div class="card"><div class="big" id="totalOrders">0</div><div class="muted">Total Orders</div></div>
        <div class="card"><div class="big" id="platformRevenue">$0</div><div class="muted">Platform Revenue</div></div>
      </div>
    </section>

    <!-- ===== Users ===== -->
    <section id="users" class="card">
      <h2>User Management</h2>
      <div class="filters">
        <select id="userRoleFilter">
          <option value="">All Roles</option>
          <option value="user">user</option>
          <option value="merchant">merchant</option>
          <option value="ADMINISTRATOR">ADMINISTRATOR</option>
        </select>
        <input id="userSearch" class="search" placeholder="Search users (ID, name, email, role)..." />
        <button id="refreshUsers" class="btn">Refresh</button>
      </div>
      

      <div class="form-row">
        <input id="firstName" placeholder="First name" />
        <input id="lastName" placeholder="Last name" />
        <input id="displayName" placeholder="Display name" />
        <input id="email" type="email" placeholder="Email" />
        <input id="profilePicture" placeholder="Profile picture URL (optional)" />
        <select id="role">
          <option value="user">user</option>
          <option value="merchant">merchant</option>
          <option value="ADMINISTRATOR">ADMINISTRATOR</option>
        </select>
        <button id="createUserBtn" class="btn-primary">Create User Doc</button>
      </div>

      <table id="usersTable">
        <thead>
          <tr>
            <th>ID</th><th>User</th><th>Email</th><th>Role</th><th>Email Verified</th><th>Last Login</th><th>Created At</th><th>Actions</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
      <div class="id-note">Tip: ID search matches the **document ID** shown in the leftmost column.</div>
    </section>

    <!-- ===== Merchant Applications ===== -->
    <section id="applications" class="card">
      <h2>Merchant Applications</h2>
      <div class="filters">
        <select id="appStatusFilter">
          <option value="">All Status</option>
          <option value="Pending Review">Pending Review</option>
          <option value="Under Review">Under Review</option>
          <option value="Approved">Approved</option>
          <option value="Rejected">Rejected</option>
        </select>
        <input id="appSearch" class="search" placeholder="Search applications (ID, business, type, city, email)..." />
        <button id="refreshApps" class="btn">Refresh</button>
      </div>
      
      <!-- Image Preview Modal -->
      <div id="imagePreviewModal" class="card" style="display:none; position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); z-index:2000; background:white; padding:20px; max-width:90%; max-height:90vh; overflow:auto; box-shadow:0 10px 30px rgba(0,0,0,0.2); border-radius:12px;">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
          <h4 style="margin:0;">Image Preview</h4>
          <button id="closeImageModal" class="btn" style="background:#dc3545; color:white; padding:6px 12px; border-radius:6px; cursor:pointer;">× Close</button>
        </div>
        <img id="modalImage" src="" style="max-width:100%; max-height:70vh; object-fit:contain; display:block; margin:0 auto; border-radius:8px;">
        <div id="modalImageCaption" style="text-align:center; margin-top:10px; font-size:14px; color:#666;"></div>
        <div style="text-align:center; margin-top:15px;">
          <a id="downloadImageLink" href="#" target="_blank" download class="btn" style="background:#28a745; color:white; padding:8px 16px; border-radius:6px; text-decoration:none;">Download Image</a>
        </div>
      </div>
      <div id="imagePreviewModalOverlay" style="display:none; position:fixed; top:0; left:0; right:0; bottom:0; background:rgba(0,0,0,0.7); z-index:1999;"></div>
      
      <!-- Merchant Applications Image Modal -->
      <div id="appImagePreviewModal" class="card" style="display:none; position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); z-index:2000; background:white; padding:20px; max-width:90%; max-height:90vh; overflow:auto; box-shadow:0 10px 30px rgba(0,0,0,0.2); border-radius:12px;">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
          <h4 style="margin:0;">Document Preview</h4>
          <button id="closeAppImageModal" class="btn" style="background:#dc3545; color:white; padding:6px 12px; border-radius:6px; cursor:pointer;">× Close</button>
        </div>
        <img id="appModalImage" src="" style="max-width:100%; max-height:70vh; object-fit:contain; display:block; margin:0 auto; border-radius:8px;">
        <div id="appModalImageCaption" style="text-align:center; margin-top:10px; font-size:14px; color:#666;"></div>
        <div style="text-align:center; margin-top:15px;">
          <a id="appDownloadImageLink" href="#" target="_blank" download class="btn" style="background:#28a745; color:white; padding:8px 16px; border-radius:6px; text-decoration:none;">Download Document</a>
        </div>
      </div>
      <div id="appImagePreviewModalOverlay" style="display:none; position:fixed; top:0; left:0; right:0; bottom:0; background:rgba(0,0,0,0.7); z-index:1999;"></div>

      <!-- Active Merchants Image Modal -->
      <div id="merchantImagePreviewModal" class="card" style="display:none; position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); z-index:2000; background:white; padding:20px; max-width:90%; max-height:90vh; overflow:auto; box-shadow:0 10px 30px rgba(0,0,0,0.2); border-radius:12px;">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
          <h4 style="margin:0;">Document Preview</h4>
          <button id="closeMerchantImageModal" class="btn" style="background:#dc3545; color:white; padding:6px 12px; border-radius:6px; cursor:pointer;">× Close</button>
        </div>
        <img id="merchantModalImage" src="" style="max-width:100%; max-height:70vh; object-fit:contain; display:block; margin:0 auto; border-radius:8px;">
        <div id="merchantModalImageCaption" style="text-align:center; margin-top:10px; font-size:14px; color:#666;"></div>
        <div style="text-align:center; margin-top:15px;">
          <a id="merchantDownloadImageLink" href="#" target="_blank" download class="btn" style="background:#28a745; color:white; padding:8px 16px; border-radius:6px; text-decoration:none;">Download Document</a>
        </div>
      </div>
      <div id="merchantImagePreviewModalOverlay" style="display:none; position:fixed; top:0; left:0; right:0; bottom:0; background:rgba(0,0,0,0.7); z-index:1999;"></div>

      <!-- Optional admin-side quick create -->
      <div class="form-row">
        <input id="appBusinessName" placeholder="Business Name" />
        <select id="appBusinessType">
          <option value="Retail">Retail</option><option value="Wholesale">Wholesale</option>
          <option value="Manufacturing">Manufacturing</option><option value="Service">Service</option>
          <option value="Technology">Technology</option><option value="Agriculture">Agriculture</option>
          <option value="Construction">Construction</option><option value="Hospitality">Hospitality</option>
          <option value="Transportation">Transportation</option><option value="Finance">Finance</option>
          <option value="Healthcare">Healthcare</option><option value="Education">Education</option>
          <option value="Real Estate">Real Estate</option><option value="Entertainment">Entertainment</option>
          <option value="Nonprofit">Nonprofit</option>
        </select>
        <input id="appAddress" placeholder="Address" />
        <select id="appCity">
          <option value="Phnom Penh">Phnom Penh</option><option value="Siem Reap">Siem Reap</option>
        </select>
        <input id="appZipcode" placeholder="Zipcode" />
        <input id="appDescription" placeholder="Business Description" />
        <input id="appApplicantEmail" placeholder="Applicant Email (optional)" />
        <button id="createAppBtn" class="btn-primary">Save Application</button>
      </div>

      <table id="merchantAppsTable">
        <thead>
          <tr>
            <th>Application ID</th><th>Business Name</th><th>Type</th><th>City</th>
            <th>Applicant Email</th><th>Business Doc</th><th>Identity Doc</th>
            <th>Applied Date</th><th>Status</th><th>Actions</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
      <div class="id-note">Note: Application IDs match the **user's doc ID** (set by the registration form).</div>
    </section>
    
    <!-- ===== Verified (Active) Merchants ===== -->
    <section id="merchants" class="card">
      <h2>Active Merchants</h2>
      <div class="filters">
        <input id="merchantSearch" class="search" placeholder="Search merchants (ID, store, owner, city, email)..." />
        <button id="refreshMerchants" class="btn">Refresh</button>
      </div>
     
      <div id="modalOverlay" style="display:none; position:fixed; top:0; left:0; right:0; bottom:0; background:rgba(0,0,0,0.5); z-index:1999;"></div>
      
      <table id="merchantsTable">
        <thead>
          <tr><th>ID</th><th>Store</th><th>Owner</th><th>City</th><th>Email</th><th>Docs</th><th>Joined</th><th>Status</th><th>Verification</th><th>Actions</th></tr>
        </thead>
        <tbody></tbody>
      </table>
    </section>
      
    <!-- ===== Orders ===== -->
    <section id="orders" class="card">
      <h2>Order Management</h2>
      
      <div class="filters">
        <select id="orderStatusFilter">
          <option value="">All Status</option>
          <option value="pending">Pending</option>
          <option value="processing">Processing</option>
          <option value="shipped">Shipped</option>
          <option value="delivered">Delivered</option>
          <option value="cancelled">Cancelled</option>
          <option value="refunded">Refunded</option>
        </select>
        <input id="orderSearch" class="search" placeholder="Search orders (ID, customer, email, product)..." />
        <button id="refreshOrders" class="btn">Refresh</button>
        <button id="createTestOrderBtn" class="btn" style="background:#28a745; color:white;">Create Test Order</button>
      </div>

      <!-- Add this Create Test Order Modal -->
      <div id="createTestOrderModal" class="card" style="display:none; position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); z-index:2000; background:white; padding:24px; max-width:600px; width:90%; max-height:80vh; overflow-y:auto; box-shadow:0 10px 30px rgba(0,0,0,0.2);">
        <h3 style="margin-top:0;">Create Test Order</h3>
        
        <div style="margin-bottom:20px;">
          <h4>Customer Information</h4>
          <div class="form-row">
            <input id="testCustomerName" placeholder="Customer Name" value="Test Customer" style="flex:1;" />
            <input id="testCustomerEmail" placeholder="Email" value="test@example.com" style="flex:1;" />
            <input id="testCustomerPhone" placeholder="Phone" value="123-456-7890" style="flex:1;" />
          </div>
        </div>
        
        <div style="margin-bottom:20px;">
          <h4>Shipping Information</h4>
          <div class="form-row">
            <input id="testShippingAddress" placeholder="Address" value="123 Test Street" style="flex:1;" />
            <input id="testShippingCity" placeholder="City" value="Phnom Penh" style="flex:1;" />
            <input id="testShippingZip" placeholder="Zip Code" value="12000" style="flex:1;" />
          </div>
        </div>
        
        <div style="margin-bottom:20px;">
          <h4>Order Items (Add up to 5 items)</h4>
          <div id="testOrderItems">
            <!-- Items will be added here dynamically -->
          </div>
          <button id="addTestItemBtn" class="btn" style="margin-top:10px;">+ Add Item</button>
        </div>
        
        <div style="margin-bottom:20px;">
          <h4>Order Details</h4>
          <div class="form-row">
            <select id="testOrderStatus" style="flex:1;">
              <option value="pending">Pending</option>
              <option value="processing">Processing</option>
              <option value="shipped">Shipped</option>
              <option value="delivered">Delivered</option>
              <option value="cancelled">Cancelled</option>
            </select>
            <select id="testPaymentStatus" style="flex:1;">
              <option value="pending">Payment Pending</option>
              <option value="paid" selected>Paid</option>
              <option value="refunded">Refunded</option>
              <option value="failed">Failed</option>
            </select>
            <select id="testPaymentMethod" style="flex:1;">
              <option value="credit_card">Credit Card</option>
              <option value="paypal">PayPal</option>
              <option value="cash_on_delivery">Cash on Delivery</option>
              <option value="bank_transfer">Bank Transfer</option>
            </select>
          </div>
        </div>
        
        <div style="margin-bottom:20px;">
          <h4>Order Summary</h4>
          <div style="background:#f8f9fa; padding:15px; border-radius:8px;">
            <div style="display:flex; justify-content:space-between; margin-bottom:8px;">
              <span>Subtotal:</span>
              <span>$<span id="testSubtotal">0.00</span></span>
            </div>
            <div style="display:flex; justify-content:space-between; margin-bottom:8px;">
              <span>Shipping:</span>
              <span>$<input id="testShippingCost" type="number" step="0.01" min="0" value="5.99" style="width:80px; padding:4px;" /></span>
            </div>
            <div style="display:flex; justify-content:space-between; margin-bottom:8px;">
              <span>Tax:</span>
              <span>$<input id="testTax" type="number" step="0.01" min="0" value="2.99" style="width:80px; padding:4px;" /></span>
            </div>
            <div style="display:flex; justify-content:space-between; margin-bottom:8px; font-weight:bold; padding-top:8px; border-top:1px solid #dee2e6;">
              <span>Total:</span>
              <span>$<span id="testTotal">0.00</span></span>
            </div>
          </div>
        </div>
        
        <div style="display:flex; gap:8px; justify-content:flex-end;">
          <button id="cancelTestOrderBtn" class="btn">Cancel</button>
          <button id="saveTestOrderBtn" class="btn" style="background:#28a745; color:white;">Create Order</button>
        </div>
      </div>
      <div id="createTestOrderModalOverlay" style="display:none; position:fixed; top:0; left:0; right:0; bottom:0; background:rgba(0,0,0,0.5); z-index:1999;"></div>
      
      <!-- Rest of your existing order modal and table remain here -->

      <!-- Order Details Modal -->
      <div id="orderModal" class="card" style="display:none; position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); z-index:2000; background:white; padding:24px; max-width:800px; width:90%; max-height:80vh; overflow-y:auto; box-shadow:0 10px 30px rgba(0,0,0,0.2);">
        <h3 style="margin-top:0;">Order Details <span id="modalOrderId" class="muted"></span></h3>
        
        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:20px; margin-bottom:20px;">
          <div>
            <h4>Customer Information</h4>
            <div><strong>Name:</strong> <span id="modalCustomerName">-</span></div>
            <div><strong>Email:</strong> <span id="modalCustomerEmail">-</span></div>
            <div><strong>Phone:</strong> <span id="modalCustomerPhone">-</span></div>
          </div>
          
          <div>
            <h4>Shipping Information</h4>
            <div><strong>Address:</strong> <span id="modalShippingAddress">-</span></div>
            <div><strong>City:</strong> <span id="modalShippingCity">-</span></div>
            <div><strong>Zip:</strong> <span id="modalShippingZip">-</span></div>
          </div>
        </div>
        
        <h4>Order Items</h4>
        <table style="width:100%; margin-bottom:20px;">
          <thead>
            <tr>
              <th>Product</th>
              <th>Quantity</th>
              <th>Price</th>
              <th>Subtotal</th>
            </tr>
          </thead>
          <tbody id="modalOrderItems"></tbody>
        </table>
        
        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:20px; margin-bottom:20px;">
          <div>
            <h4>Order Summary</h4>
            <div><strong>Subtotal:</strong> $<span id="modalSubtotal">0.00</span></div>
            <div><strong>Shipping:</strong> $<span id="modalShippingCost">0.00</span></div>
            <div><strong>Tax:</strong> $<span id="modalTax">0.00</span></div>
            <div><strong>Total:</strong> $<span id="modalTotal">0.00</span></div>
          </div>
          
          <div>
            <h4>Order Status</h4>
            <div><strong>Current Status:</strong> <span id="modalCurrentStatus" class="chip"></span></div>
            <div><strong>Payment Status:</strong> <span id="modalPaymentStatus">-</span></div>
            <div><strong>Order Date:</strong> <span id="modalOrderDate">-</span></div>
          </div>
        </div>
        
        <div style="margin-bottom:20px;">
          <h4>Update Status</h4>
          <div style="display:flex; gap:10px; flex-wrap:wrap;">
            <button class="btn" data-status-action="pending">Set Pending</button>
            <button class="btn" data-status-action="processing">Set Processing</button>
            <button class="btn" data-status-action="shipped">Set Shipped</button>
            <button class="btn" data-status-action="delivered">Set Delivered</button>
            <button class="btn" style="background:#dc3545; color:white;" data-status-action="cancelled">Cancel Order</button>
            <button class="btn" style="background:#ffc107; color:black;" data-status-action="refunded">Refund</button>
          </div>
        </div>
        
        <div style="display:flex; gap:8px; justify-content:flex-end;">
          <button id="closeOrderModal" class="btn">Close</button>
        </div>
      </div>
      <div id="orderModalOverlay" style="display:none; position:fixed; top:0; left:0; right:0; bottom:0; background:rgba(0,0,0,0.5); z-index:1999;"></div>

      <table id="ordersTable">
        <thead>
          <tr>
            <th>Order ID</th>
            <th>Customer</th>
            <th>Items</th>
            <th>Total</th>
            <th>Status</th>
            <th>Payment</th>
            <th>Date</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </section>

    <!-- ===== Product Management ===== -->
    <section id="products" class="card">
      <h2>Product Management</h2>
      <div class="filters">
        <select id="productCategoryFilter">
          <option value="">Select Category</option>
          <option value="Electronics">Electronics & Gadgets</option>
          <option value="Clothing">Clothing & Fashion</option>
          <option value="Footwear">Footwear & Shoes</option>
          <option value="Home & Garden">Home & Garden</option>
          <option value="Kitchen">Kitchen & Dining</option>
          <option value="Furniture">Furniture & Decor</option>
          <option value="Sports">Sports & Outdoors</option>
          <option value="Books">Books & Stationery</option>
          <option value="Health">Health & Beauty</option>
          <option value="Toys">Toys & Games</option>
          <option value="Automotive">Automotive Parts</option>
          <option value="Jewelry">Jewelry & Accessories</option>
          <option value="Food">Food & Beverages</option>
          <option value="Pet">Pet Supplies</option>
          <option value="Office">Office Supplies</option>
          <option value="Tools">Tools & Hardware</option>
          <option value="Baby">Baby & Kids</option>
          <option value="Art">Art & Crafts</option>
          <option value="Musical">Musical Instruments</option>
          <option value="Other">Other</option>
        </select>
        <select id="productStatusFilter">
          <option value="">All Status</option>
          <option value="active">Active</option>
          <option value="inactive">Inactive</option>
          <option value="out_of_stock">Out of Stock</option>
        </select>
        <input id="productSearch" class="search" placeholder="Search products (name, description, merchant ID)..." />
        <button id="refreshProducts" class="btn">Refresh</button>
      </div>

      <!-- Create/Edit Product Form -->
      <div class="form-row" style="margin-bottom: 16px;">
        <input id="productName" placeholder="Product Name" />
        <input id="productDescription" placeholder="Description" />
        <input id="productPrice" type="number" placeholder="Price" step="0.01" min="0" />
        <input id="productStockQty" type="number" placeholder="Stock Quantity" min="0" />
        <select id="productCategory">
          <option value="">Select Category</option>
          <option value="Electronics">Electronics & Gadgets</option>
          <option value="Clothing">Clothing & Fashion</option>
          <option value="Footwear">Footwear & Shoes</option>
          <option value="Home & Garden">Home & Garden</option>
          <option value="Kitchen">Kitchen & Dining</option>
          <option value="Furniture">Furniture & Decor</option>
          <option value="Sports">Sports & Outdoors</option>
          <option value="Books">Books & Stationery</option>
          <option value="Health">Health & Beauty</option>
          <option value="Toys">Toys & Games</option>
          <option value="Automotive">Automotive Parts</option>
          <option value="Jewelry">Jewelry & Accessories</option>
          <option value="Food">Food & Beverages</option>
          <option value="Pet">Pet Supplies</option>
          <option value="Office">Office Supplies</option>
          <option value="Tools">Tools & Hardware</option>
          <option value="Baby">Baby & Kids</option>
          <option value="Art">Art & Crafts</option>
          <option value="Musical">Musical Instruments</option>
          <option value="Other">Other</option>
        </select>
        <select id="productStatus">
          <option value="active">Active</option>
          <option value="inactive">Inactive</option>
          <option value="out_of_stock">Out of Stock</option>
        </select>
        <input id="productMerchantId" placeholder="Merchant ID (optional)" />
      </div>

      <!-- Image Upload Section -->
      <div class="form-row" style="margin-bottom: 16px;">
        <div style="width: 100%;">
          <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">Product Image</label>
          <div class="image-upload-container">
            <!-- Image Preview -->
            <div class="image-preview" id="imagePreview" style="display: none;">
              <img id="previewImage" src="#" alt="Preview" style="max-width: 200px; max-height: 200px;">
              <div class="image-actions">
                <button type="button" class="remove-image-btn" onclick="removeProductImage()">
                  <i class="fas fa-trash"></i> Remove Image
                </button>
              </div>
            </div>
            
            <!-- Upload Area -->
            <div class="upload-area" id="uploadArea">
              <input type="file" id="productImageInput" accept="image/*" style="display: none;">
              <div class="upload-placeholder" onclick="document.getElementById('productImageInput').click()">
                <i class="fas fa-cloud-upload-alt" style="font-size: 32px; color: #2c7ef8; margin-bottom: 8px;"></i>
                <p>Click to upload product image</p>
                <p style="font-size: 11px; color: #999; margin-top: 4px;">Max size: 2MB • JPG, PNG, WebP</p>
              </div>
            </div>
            
            <!-- Upload Progress -->
            <div class="upload-progress" id="uploadProgress" style="display: none;">
              <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
              </div>
              <p class="progress-text" id="progressText">Uploading: 0%</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="form-row">
        <button id="createProductBtn" class="btn-primary">Create Product</button>
        <button id="updateProductBtn" class="btn" style="display:none;">Update Product</button>
        <button id="cancelEditBtn" class="btn" style="display:none;">Cancel</button>
      </div>

      <table id="productsTable">
        <thead>
          <tr>
            <th>ID</th>
            <th>Image</th>
            <th>Name</th>
            <th>Category</th>
            <th>Price</th>
            <th>Stock</th>
            <th>Status</th>
            <th>Merchant ID</th>
            <th>Created At</th>
            <th>Updated At</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </section>
  </main>

  <script src="admin-gs.js" defer></script>
  <script type="module" src="admin-ms.js"></script>
 
  
</body>
</html>